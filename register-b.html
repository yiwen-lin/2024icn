<!-- Header Link -->
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Register | ICN Merger Workshop</title>
    <link rel="icon" href="assets/img/faveicon.png" type="image/gif" sizes="16x16">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="assets/css/plugin.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body class="register-page">


<!-- Header Section -->
<!-- Header Start Here -->
<header class="header-area header-general">
    <div class="container">
        <div class="header-wrapper header-general-wrapper">
            <div class="logo">
                <a href="index.html">
                    <img src="assets/img/logo/logo.png" alt="logo">
                </a>
            </div>
            <div class="header-wrap ">
                <!-- Menu Start -->
                <div class="main-menu ">
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="agenda.html">Agenda</a></li>
                        <li><a href="venue.html">Venue</a></li>
                        <li><a href="accommodation.html">Accommodation</a></li>
                        <li><a href="events.html">Social Events</a></li>
                        <li><a href="highlight.html">Highlight</a></li>
                        <li><a href="faq.html">FAQ</a></li>
                        <li><a href="login.html"><i class="icofont-user-alt-6"></i></a></li>
                    </ul>
                </div>
                <!-- Menu Start -->
                <div class="header-right">
                    <div class="book-ticket header-account">
                        <a class="btn btn-lg-space btn-bg-g-secondary" href="register.html">Register</a>
                    </div>
                    <div class="hamburger">
                        <div class="plates">
                            <!--  onclick="this.classList.toggle('active')" -->
                            <div class="plate plate5">
                                <svg class="burger" version="1.1" height="100" width="100" viewBox="0 0 100 100">
                                    <path class="line line1" d="M 30,35 H 70 " />
                                    <path class="line line2" d="M 50,50 H 30 L 34,32" />
                                    <path class="line line3" d="M 50,50 H 70 L 66,68" />
                                    <path class="line line4" d="M 30,65 H 70 " />
                                </svg>
                                <svg class="x" version="1.1" height="100" width="100" viewBox="0 0 100 100">
                                    <path class="line" d="M 34,32 L 66,68" />
                                    <path class="line" d="M 66,32 L 34,68" />
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
<!-- Header End Here -->

<section class="login-area register-area s-pb-100">
    <div class="container-fluid">
        <div class="login-wrapper">

            <!-- <div class="login-thumb">
                <img src="assets/img/thumb/register-thumb.png" alt="sign-up">
            </div> -->
            <form method="post" id="register-editor" class="login-form">
                <div class="from-title">
                    <h1 data-aos="fade-up" data-aos-delay="10" class="mb-20">Registration</h1>
                    <p>Email:<span id="email">XXX@XXXX.XXX</span></p>
                    <p  class="mb-20">Password:<span id="password">ＯＯＯＯＯＯ</span></p>
                </div>

                <div class="login-input">
                    <div class="single-form mb-20" data-aos="fade-up" data-aos-delay="200">
                        <label>First Name *</label>
                        <div class="from-box">
                            <input type="text" placeholder="" class="form-control" name="first_name">
                        </div>
                    </div>
                    <div class="single-form mb-20" data-aos="fade-up" data-aos-delay="200">
                        <label>Surname Name *</label>
                        <div class="from-box">
                            <input type="text" placeholder="" class="form-control" name="surname_name">
                        </div>
                    </div>
                    <div class="single-form mb-20" data-aos="fade-up" data-aos-delay="200">
                        <label>Pronoun *​</label>
                        <div class="from-box">
                            <select class="form-select" required name="pronoun">
                                <option selected disabled value=""></option>
                                <option value="male">He/Him</option>
                                <option value="female">She/her</option>
                                <option value="other">They/them​</option>
                            </select>
                        </div>
                    </div>
                    <div class="single-form mb-20" data-aos="fade-up" data-aos-delay="200">
                        <label>Type of Participant​ *​</label>
                        <div class="from-box">
                            <select id="select_participant" class="form-select" required name="participant_type">
                                <option selected disabled value="">​</option>
                                <option value="participant_nca">NCA (National Competition Authorities)</option>
                                <option value="participant_nga">NGA (Non Governmental Advisors)</option>
                            </select>
                        </div>
                    </div>
                    <div id="nca_name_ipt" class="single-form mb-20" data-aos="fade-up" data-aos-delay="200">
                        <label>If NCA, name of authority and person that invited you.​ *</label>
                        <div class="from-box">
                            <input type="text" placeholder="" class="form-control" name="nca_name">
                        </div>
                    </div>
                    <div class="single-form mb-20" data-aos="fade-up" data-aos-delay="200">
                        <label>Agency / Firm Name *​​</label>
                        <div class="from-box">
                            <input type="text" placeholder="" class="form-control" name="agency">
                        </div>
                    </div>
                    <div class="single-form mb-20" data-aos="fade-up" data-aos-delay="200">
                        <label>Job Title / Position​ *​​</label>
                        <div class="from-box">
                            <input type="text" placeholder="" class="form-control"  name="job_title">
                        </div>
                    </div>
                    <div class="single-form mb-20" data-aos="fade-up" data-aos-delay="200">
                        <label>Address​​ *​​</label>
                        <div class="from-box">
                            <input type="text" placeholder="" class="form-control" name="address">
                            <i class="icofont-location-pin"></i>
                        </div>
                    </div>
                    <div class="single-form mb-20" data-aos="fade-up" data-aos-delay="200">
                        <label>Country​ *​​</label>
                        <div class="from-box">
                            <input type="text" placeholder="" class="form-control" name="country">
                            <i class="icofont-globe"></i>
                        </div>
                    </div>
                    <div class="single-form mb-20" data-aos="fade-up" data-aos-delay="200">
                        <label>Work Phone *​​</label>
                        <div class="from-box">
                            <input type="text" placeholder="" class="form-control" name="work_phone">
                            <i class="icofont-phone"></i>
                        </div>
                    </div>
                    <div class="single-form mb-20" data-aos="fade-up" data-aos-delay="200">
                        <label>Mobile Phone​</label>
                        <div class="from-box">
                            <input type="text" placeholder="" class="form-control" name="mobile_phone">
                            <i class="icofont-iphone"></i>
                        </div>
                    </div>
                    <div class="single-form mb-20" data-aos="fade-up" data-aos-delay="200">
                        <label>Please enroll the welcome reception (11/12  18:00-21:00) *​</label>
                        <div class="from-box">
                            <select class="form-select form-control" required name="welcome_reception">
                                <option selected disabled value="">​</option>
                                <option value="1">YES​</option>
                                <option value="0">NO​</option>
                            </select>
                        </div>
                    </div>
                    <div class="single-form mb-20" data-aos="fade-up" data-aos-delay="200">
                        <label>Do you need a letter of invitation for visa purpose?(Please note these letters will be sent separately from your confirmation email)  *​</label>
                        <div class="from-box">
                            <select class="form-select form-control" required name="invitation_letter">
                                <option selected disabled value="">​</option>
                                <option value="1">YES​</option>
                                <option value="0">NO​</option>
                            </select>
                        </div>
                    </div>
                    <div class="single-form mb-20" data-aos="fade-up" data-aos-delay="200">
                        <label>Please select the social events that you will attend (optional) 11/15  14:30-18:00​​</label>
                        <div class="from-box">
                            <select class="form-select form-control" required name="social_events">
                                <option selected disabled value="">​</option>
                                <option value="social_01">Taipei 101 (Observatory and Shopping)​</option>
                                <option value="social_02">National Palace Museum (A cultural and artistic tour)​</option>
                                <option value="social_03">Dadaocheng (A guided walking tour of traditional merchant streets.)​</option>
                                <option value="social_04">Not Participate​</option>
                            </select>
                        </div>
                    </div>
                    <div class="single-form mb-20" data-aos="fade-up" data-aos-delay="200">
                        <label>Special Services:The TFTC will make every attempt to accommodate special needs. Please indicate any dietary or special needs.​</label>
                        <div class="from-box">
                            <select id="select_diet" class="form-control form-select required" name="special_services">
                                <option selected disabled value="">​</option>
                                <option value="vegetarian">Vegetarian</option>
                                <option value="other">Others:</option>
                            </select>
                        </div>
                    </div>
                    <div id="other_diet_ipt" class="single-form mb-20" data-aos="fade-up" data-aos-delay="200">
                        <label>If other, answer here.​ *</label>
                        <div class="from-box">
                            <input name="special_services_others" class="required" type="text" placeholder="">
                        </div>
                    </div>
                    <input type="hidden" name="email">
                    <input type="hidden" name="password">
                    <input type="submit" class="btn btn-lg-space" data-aos="fade-up" data-aos-delay="600" value="Submit">
                </div>
                <!-- <div class="login-footer" data-aos="fade-up" data-aos-delay="700">
                    <p>Already have account? <a href="login.html">Login</a></p>
                </div> -->
            </form>
        </div>
    </div>
</section>


<!-- Footer Area Start Here -->
<footer class="primary-footer-area py-70 py-md-40 bg-dark secondary-footer">
    <div class="container">
        <div class="footer-items">
            <div class="footer-contact">
                <h4 class="footer-title">Contact Us</h4>
                <a href="mailto:info.2024icn.merger@ftc.gov.tw"><i class="icofont-ui-message"></i>info.2024icn.merger@ftc.gov.tw</a>
            </div>
        </div>
    </div>
</footer>
<!-- Footer Area End Here -->
<!-- Copy Right Start Here -->
<div class="copyright">
    <p>Copyright © 2024 FAIR TRADE COMMISSION. All rights reserved.​</p>
</div>
<!-- Copy Right End Here -->
<!-- Footer Area End Here -->
<!-- Footer script-->
<!-- Jquery call here-->
<script src="assets/js/app.min.js"></script>
<!-- custom script call here -->
<script src="assets/js/scripts.js"></script>
<script>
    const REGISTER_EDITOR_API_URL = 'https://epass.icn2024merger.tw/api/update';
    const BEARER_TOKEN = 'KU3mDVHXaLiVt2kjfGT0k69OoJf3CWH9z3zbugzlbcc0e25b';

    $(function () {
        $('#select_participant').on('change', function () {
            let selectVal = $(this).find(":selected").val();
            checkParticipantType(selectVal);
        });

        $('#select_diet').on('change', function () {
            let selectVal = $(this).find(":selected").val();
            checkDietType(selectVal);
        });

        const LOGIN_URL = 'login.html';

        let form = document.getElementById('register-editor');

        setRegisterData();

        form.addEventListener('submit', function (e) {
            e.preventDefault();

            let checkValid = validateInputs();

            if (checkValid) {
                const form = e.target;
                const formData = new FormData(form);

                const data = {};
                let email = '';

                formData.forEach((value, key) => {
                    if (key === 'email') {
                        email = value;
                    }
                    if (['confirm_password'].indexOf(key) === -1) {
                        data[key] = value;
                    }
                });

                fetch(REGISTER_EDITOR_API_URL, {
                    method: 'PUT',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${BEARER_TOKEN}`
                    },
                    body: JSON.stringify(data)
                }).then((response) => {
                    if (response.ok === true) {
                        return response.json();
                    } else if (response.status === 422) {
                        return response.json().then(errorData => {
                            let errorMessages = [];
                            for (const [field, errors] of Object.entries(errorData.errors)) {
                                errors.forEach(error => {
                                    errorMessages.push(errors);
                                    form.querySelector(`[name="${field}"]`).parentNode.classList.add("error");
                                    console.error(`${field}: ${error}`);
                                });
                            }

                            alert(errorMessages.join('\n'));

                            focusValidateInput();

                            throw new Error('Validation failed');
                        });
                    } else if (response.status === 404) {
                        return response.json().then(response => {
                            alert(response.message);

                            throw new Error(response.message);
                        });
                    } else {
                        return response.text().then(text => {
                            throw new Error(response.statusText + ": " + text);
                        });
                    }
                }).then((responseData) => {
                    alert('Success');
                    console.log('Success', responseData);
                }).catch(error => {
                    console.error('Fetch error:', error);
                }).finally(() => {
                });
            } else {
                alert('You have required fields that are not filled out. Please complete them before submitting.');
            }
        });

        function setRegisterData() {
            let registerData = localStorage.getItem('registerData');
            if (registerData === null) {
                window.location.href = LOGIN_URL;
            }

            registerData = JSON.parse(localStorage.getItem('registerData'));

            for (const [field, data] of Object.entries(registerData)) {
                let targetElement = form.querySelector(`[name="${field}"]`);
                if (targetElement !== null) {
                    targetElement.value = data;
                    if (field === 'participant_type') {
                        checkParticipantType(data);
                    }

                    if (field === 'special_services') {
                        checkDietType(data);
                    }

                    if (['email', 'password'].indexOf(field) !== -1) {
                        let setTextElementTarget = document.getElementById(field);
                        setTextElementTarget.textContent = data;
                    }
                }
            }

            localStorage.removeItem('registerData');
        }

        function validateInputs() {
            var inputs = form.querySelectorAll('.form-control');
            var valid = [];
            var radioCheck = false;
            var checkboxCheck = false;
            inputs.forEach(function (i, j) {
                var checkAttr = i.tagName;
                if(i.getAttribute('type')){
                    checkAttr = i.getAttribute('type');
                }

                switch(checkAttr){
                    case 'text':
                        var _thisVal = i.value;
                        if (_thisVal === '') {
                            i.parentNode.classList.add("error");
                            valid.push(i.getAttribute('name'));
                        }else{
                            i.parentNode.classList.remove("error");
                        }
                        break;
                    case 'select':
                        if (i[select.selectedIndex].value === '') {
                            i.parentNode.classList.add("error");
                            valid.push(i.getAttribute('name'));
                        } else {
                            i.parentNode.classList.remove("error");
                        }
                        break;
                    default:
                        if (i.value === '') {
                            i.parentNode.classList.add("error");
                            valid.push(i.getAttribute('name'));
                        } else {
                            i.parentNode.classList.remove("error");
                        }
                        break;
                }
            });

            if (valid.length > 0) {
                focusValidateInput();

                return false;
            } else {
                return true;
            }
        }

        function focusValidateInput() {
            const targetTop = form.querySelector(`.error`).parentNode.offsetTop;
            const header = document.querySelector(`header`).offsetHeight;
            const scrollTop = targetTop - header - 200;
            window.scrollTo({
                top: scrollTop > 0 ? scrollTop : 0,
                behavior: "smooth",
            });
        }

        function checkParticipantType(selectVal) {
            if (selectVal === 'participant_nca') {
                $('#nca_name_ipt').show();
                $('#nca_name_ipt').find('input').addClass('form-control');
            } else if (selectVal === 'participant_nga') {
                $('#nca_name_ipt').hide();
                $('#nca_name_ipt').find('input').removeClass('form-control');
            }
        }

        function checkDietType(selectVal) {
            if (selectVal === 'other') {
                $('#other_diet_ipt').show();
                $('#other_diet_ipt').find('input').addClass('form-control');
            } else if (selectVal === 'vegetarian') {
                $('#other_diet_ipt').hide();
                $('#other_diet_ipt').find('input').removeClass('form-control');
            }
        }
    });
</script>
</body>
</html>
